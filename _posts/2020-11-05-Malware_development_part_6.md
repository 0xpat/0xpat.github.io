---
title: Malware development part 6
layout: post
---

# Introduction
This is the fifth post of a series which regards the development of malicious software. In this series we will explore and try to implement multiple techniques used by malicious applications to execute code, hide from defenses and persist.

In the previous posts we explored anti-VM, anti-sandbox, anti-debugging and anti-static-analysis methods.

This time we will explore anti-disassembly obfuscation using LLVM.

# What is LLVM?
LLVM is a compiler infrastructure. To understand what it is exactly we need to dive into compilation process (this is most accurate for unmanaged code like C/C++).

We can distinguish three steps of assembly generation from source code:
1. Front end, which includes:  
	* scanner, which performs lexical analysis of code and produces tokens (strings with certain meaning)
	* parser, which produces an abstract syntax tree (tokens grouped in a tree which represents the actual algorithm implemented in the source code)
	* semantic analysis (mainly type checking), during which the AST is checked for errors like wrong use of types or use of variables before initialization
	* generation of intermediate representation, usually based on AST
2. Optimization, which aims at reducing code complexity for example by precalculating stuff. Optimization must not change the algorithm/program itself.
3. Back end, which translates the intermediate representation to expected output (assembly or bytecode).

The core of LLVM is the optimizer but the project also includes a compiler front end - `clang` - which is intended to be used with the LLVM toolchain.

## Obfuscator-LLVM
We will leverage [`Obfuscator-LLVM`](https://github.com/obfuscator-llvm/obfuscator) project which is an open-source fork of the LLVM.

Obfuscation works on the mentioned intermediate representation (IR) level. In other words it's a kind of 'anti'-optimization. `Clang` is used to generate IR from source code, then the IR is processed to obfuscate code flow and finally the assembly is generated.
